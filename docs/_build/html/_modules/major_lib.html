<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>major_lib &mdash; GeoWell 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            GeoWell
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">GeoWell — kopia</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GeoWell</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">major_lib</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for major_lib</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module defines most functions used in calculator&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">fdm</span> <span class="k">as</span> <span class="nn">fdm</span>
<span class="kn">import</span> <span class="nn">wells</span> <span class="k">as</span> <span class="nn">pw</span>

<div class="viewcode-block" id="nodes_bottom">
<a class="viewcode-back" href="../major_lib.html#major_lib.nodes_bottom">[docs]</a>
<span class="k">def</span> <span class="nf">nodes_bottom</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nodes at the bottom</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
        <span class="n">nn</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">nn</span></div>



<div class="viewcode-block" id="nodes_top">
<a class="viewcode-back" href="../major_lib.html#major_lib.nodes_top">[docs]</a>
<span class="k">def</span> <span class="nf">nodes_top</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nodes at the top</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
        <span class="n">nn</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">nn</span></div>



<div class="viewcode-block" id="prt_mtx">
<a class="viewcode-back" href="../major_lib.html#major_lib.prt_mtx">[docs]</a>
<span class="k">def</span> <span class="nf">prt_mtx</span><span class="p">(</span><span class="n">mtx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function which rounds elements of matrix up to 4 decimal places</span>

<span class="sd">    Args:</span>
<span class="sd">        mtx: matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">        rounded elements in a matrix mtx</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">formatted_mtx</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">element</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mtx</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">formatted_mtx</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span></div>



<div class="viewcode-block" id="rows">
<a class="viewcode-back" href="../major_lib.html#major_lib.rows">[docs]</a>
<span class="k">def</span> <span class="nf">rows</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function returns the number of rows in a matrix a</span>

<span class="sd">    Args:</span>
<span class="sd">        a: matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">        number of rows in a matrix a</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span></div>



<div class="viewcode-block" id="cols">
<a class="viewcode-back" href="../major_lib.html#major_lib.cols">[docs]</a>
<span class="k">def</span> <span class="nf">cols</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function returns the number of columns in a matrix a</span>

<span class="sd">    Args:</span>
<span class="sd">        a: matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">        number of columns in a matrix a</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span></div>



<div class="viewcode-block" id="interp_1d">
<a class="viewcode-back" href="../major_lib.html#major_lib.interp_1d">[docs]</a>
<span class="k">def</span> <span class="nf">interp_1d</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Linear interpolation between fixed values; 1d case</span>

<span class="sd">    Args:</span>
<span class="sd">        a: matrix</span>
<span class="sd">        x: searched value</span>

<span class="sd">    Returns:</span>
<span class="sd">        return interpolated value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">a</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">x</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">y</span></div>



<div class="viewcode-block" id="seek_actv_nodes">
<a class="viewcode-back" href="../major_lib.html#major_lib.seek_actv_nodes">[docs]</a>
<span class="k">def</span> <span class="nf">seek_actv_nodes</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">fix_nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Procedure to find out active nodes, based on fixed nodes (boundary or the 1st type boundary condition)</span>

<span class="sd">    Args:</span>
<span class="sd">        nc: matrix with nodes coordinates</span>
<span class="sd">        fix_nodes: fixed nodes (boundary or the 1st type boundary condition)</span>

<span class="sd">    Returns:</span>
<span class="sd">        active nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">actv_nodes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fix_nodes</span><span class="p">:</span>
            <span class="n">actv_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">actv_nodes</span></div>



<div class="viewcode-block" id="divide_z">
<a class="viewcode-back" href="../major_lib.html#major_lib.divide_z">[docs]</a>
<span class="k">def</span> <span class="nf">divide_z</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">nz</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The function divides the segment from x1 to x2 into nz equal parts</span>

<span class="sd">    Args:</span>
<span class="sd">        x1: first point of segment</span>
<span class="sd">        x2: second(last) point of segment</span>
<span class="sd">        nz: number of intervals</span>

<span class="sd">    Returns:</span>
<span class="sd">        coordinate list of intervals</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dz</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">/</span> <span class="n">nz</span>
    <span class="n">z2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
    <span class="n">wsp_x</span> <span class="o">=</span> <span class="n">x1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">nz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">z2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wsp_x</span> <span class="o">+</span> <span class="n">dz</span><span class="p">)</span>
        <span class="n">wsp_x</span> <span class="o">=</span> <span class="n">wsp_x</span> <span class="o">+</span> <span class="n">dz</span>

    <span class="k">return</span> <span class="n">z2</span></div>



<div class="viewcode-block" id="divide_from_to">
<a class="viewcode-back" href="../major_lib.html#major_lib.divide_from_to">[docs]</a>
<span class="k">def</span> <span class="nf">divide_from_to</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">dx1</span><span class="p">,</span> <span class="n">ndx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The function divides the segment from x1 to x2, where last spatial step is dx1</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        x1: first point of segment</span>
<span class="sd">        x2: second point of segment</span>
<span class="sd">        dx1: last spatial step of interval</span>
<span class="sd">        ndx: number of intervals</span>

<span class="sd">    Returns:</span>
<span class="sd">        coordinate list of intervals</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xa</span> <span class="o">=</span> <span class="n">x1</span>
    <span class="n">dxa</span> <span class="o">=</span> <span class="n">dx1</span>
    <span class="n">wsp_x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">wsp_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">xa</span> <span class="o">+</span> <span class="n">dxa</span> <span class="o">*</span> <span class="n">ndx</span> <span class="o">&lt;</span> <span class="n">x2</span><span class="p">:</span>
        <span class="n">xa</span> <span class="o">=</span> <span class="n">xa</span> <span class="o">+</span> <span class="n">dxa</span> <span class="o">*</span> <span class="n">ndx</span>
        <span class="n">dxa</span> <span class="o">=</span> <span class="n">dxa</span> <span class="o">*</span> <span class="n">ndx</span>
        <span class="n">wsp_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xa</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">+</span> <span class="n">wsp_x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">wsp_x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">wsp_x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">wsp_x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">last</span>

    <span class="n">wsp_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wsp_x</span></div>



<div class="viewcode-block" id="well_geometry_in">
<a class="viewcode-back" href="../major_lib.html#major_lib.well_geometry_in">[docs]</a>
<span class="k">def</span> <span class="nf">well_geometry_in</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reading input file from excel</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name: input excel file name</span>

<span class="sd">    Returns:</span>
<span class="sd">        matrix of input values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">file_name</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;geo&quot;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="s2">&quot;A:I&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span>
    <span class="k">return</span> <span class="n">out</span></div>



<div class="viewcode-block" id="prof_temp_start">
<a class="viewcode-back" href="../major_lib.html#major_lib.prof_temp_start">[docs]</a>
<span class="k">def</span> <span class="nf">prof_temp_start</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">IN</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initial temperature generator</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name: str input excel file name</span>
<span class="sd">        IN: geometry of well in input excel file</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        matrix with distribution of temperature in geometry </span>
<span class="sd">    &quot;&quot;&quot;</span>
    

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">IN</span><span class="p">)):</span>
        

        <span class="c1"># if temperature distribution is empty (in the input file) then it will be calculated and filled by the Z coordinate</span>
        <span class="n">PrmMat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
            <span class="n">file_name</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;mat&quot;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="s2">&quot;A:D&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">prm</span> <span class="o">=</span> <span class="n">PrmMat</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># estimation of geothermal power denisity q [W/m²]</span>
        <span class="c1"># below R is the thermal reseistivity factor [(m² K)/W], not the radius</span>
        <span class="n">R</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rows</span><span class="p">(</span><span class="n">IN</span><span class="p">)):</span>
            <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">prm</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span>
        <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">IN</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">IN</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">IN</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

        <span class="c1"># we have q [W/m2], now it is the time to calculate temperatures counting from the Earth surface</span>

        <span class="n">IN</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">IN</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="n">IN</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">IN</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">prm</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">IN</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="p">(</span><span class="n">IN</span><span class="p">)):</span>
            <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">prm</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">IN</span> <span class="o">=</span> <span class="n">IN</span>

    <span class="c1"># thermal profile curve</span>
    <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rows</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="c1"># due to in the input file we operate on diameters we recalculate it to radius, simply dividing by 2 (collumns 4, 6 and 8, counting from 0)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">IN</span><span class="p">)):</span>
        <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span>
    <span class="c1"># the loop below allows you to see temperature profile at the begining</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rows</span><span class="p">(</span><span class="n">IN</span><span class="p">)):</span>
        <span class="n">th</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">th</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if 1 - shows the temperature profile in the file defined a well</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">th</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">th</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">IN</span></div>



<div class="viewcode-block" id="skip_small_differences">
<a class="viewcode-back" href="../major_lib.html#major_lib.skip_small_differences">[docs]</a>
<span class="k">def</span> <span class="nf">skip_small_differences</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">difference</span><span class="p">,</span> <span class="n">n_digit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to skip small differences</span>

<span class="sd">    Args:</span>
<span class="sd">        a: matrix</span>
<span class="sd">        difference: factor of difference</span>
<span class="sd">        n_digit: number of decimals to use when rounding the number</span>

<span class="sd">    Returns:</span>
<span class="sd">        shortened values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">difference</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">n_digit</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">b</span></div>



<div class="viewcode-block" id="grid_gener">
<a class="viewcode-back" href="../major_lib.html#major_lib.grid_gener">[docs]</a>
<span class="k">def</span> <span class="nf">grid_gener</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">max_z</span><span class="p">,</span> <span class="n">nr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function for grid generation</span>

<span class="sd">    Args:</span>
<span class="sd">        geom: geometry definition from excel input file</span>
<span class="sd">        max_z: maximal allowed step on Z axis (depth)</span>
<span class="sd">        nr: increasement of R behind the defined zone (IN variable)</span>

<span class="sd">    Return:</span>
<span class="sd">        matrix of grid nodes   </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rows</span><span class="p">(</span><span class="n">geom</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rows</span><span class="p">(</span><span class="n">geom</span><span class="p">)):</span>
        <span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">geom</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rows</span><span class="p">(</span><span class="n">geom</span><span class="p">)):</span>
        <span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">geom</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">rows</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span> <span class="mi">6</span><span class="p">]</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>  
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>  
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
    <span class="n">rNext</span> <span class="o">=</span> <span class="n">divide_from_to</span><span class="p">(</span>
        <span class="n">r2</span><span class="p">[</span><span class="n">rows</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">geom</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">cols</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">(</span><span class="n">r2</span><span class="p">[</span><span class="n">rows</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r2</span><span class="p">[</span><span class="n">rows</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]),</span>
        <span class="n">nr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="p">(</span><span class="n">rNext</span><span class="p">)):</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">rNext</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if = 1, show the grid as x-y plot by R</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c1"># --- Z coordinates</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">z2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">nk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">geom</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="p">(</span><span class="n">geom</span><span class="p">)):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">geom</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="c1"># adding the last part</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">geom</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rows</span><span class="p">(</span><span class="n">geom</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">max_z</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">DZ</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dz</span><span class="p">,</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">nk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nk</span><span class="p">,</span> <span class="n">DZ</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DZ</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">z</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">max_z</span><span class="p">)</span>
            <span class="n">dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dz</span><span class="p">,</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">DZ</span><span class="p">)</span>
            <span class="n">nk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nk</span><span class="p">,</span> <span class="nb">int</span><span class="p">((</span><span class="n">z</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">max_z</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rows</span><span class="p">(</span><span class="n">nk</span><span class="p">)):</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z2</span><span class="p">,</span> <span class="n">divide_z</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">nk</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="c1"># delete repetitions</span>
    <span class="c1"># due to values are rounded values ​​with small differences may be repeated,</span>
    <span class="n">z2hlp</span> <span class="o">=</span> <span class="n">skip_small_differences</span><span class="p">(</span><span class="n">z2</span><span class="p">,</span> <span class="mf">1.0e-4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="c1"># we ignore them here and round values to E-4 meter (4-th digit)</span>
    <span class="n">z3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">z2hlp</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">z3</span><span class="p">:</span>
            <span class="n">z3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z3</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
    <span class="n">z3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">z3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if = 1, show the grid as x-y plot, by Z</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z3</span><span class="p">,</span> <span class="n">z3</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashdot&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c1"># R nodes coordinates versus R, Z nodes coordinates cersus Z</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">r2</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">z3</span>
    <span class="n">nNod</span> <span class="o">=</span> <span class="n">rows</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">rows</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>  <span class="c1"># number of nodes in the grid</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
    <span class="c1"># print(R)</span>
    <span class="c1"># print(Z)</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="nodes_to_elements">
<a class="viewcode-back" href="../major_lib.html#major_lib.nodes_to_elements">[docs]</a>
<span class="k">def</span> <span class="nf">nodes_to_elements</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determining the affiliation of nodes to elements, the number of the element is just the row number</span>

<span class="sd">    .. code-block:: none</span>

<span class="sd">        numbering scheme: #1 - node of the grid no. 1, [3] - grid element no. 3</span>
<span class="sd">        </span>
<span class="sd">                              8       12     16</span>
<span class="sd">                     4 #------#-------#-------#--------# 20              0,0 ---------------► R [m]</span>
<span class="sd">                       |      |       |       |        |                  |</span>
<span class="sd">                       |  [3] | [6]   |  [9]  |  [12]  |                  |</span>
<span class="sd">                       |     7|     11|     15|        |                  |</span>
<span class="sd">                     3 #------#-------#-------#--------# 19               |    </span>
<span class="sd">                       |      |       |       |        |                  |</span>
<span class="sd">                       |  [2] | [5]   |  [8]  |  [11]  |                  |</span>
<span class="sd">                       |     6|     10|     14|        |                  |</span>
<span class="sd">                     2 #------#-------#-------#--------# 18               |</span>
<span class="sd">                       |      |       |       |        |                  |</span>
<span class="sd">                       | [1]  |  [4]  |  [7]  |  [10]  |                  |</span>
<span class="sd">                       |     5|      9|     13|        |                  |</span>
<span class="sd">                     1 #------#-------#-------#--------# 17               |</span>
<span class="sd">                                                                    Z [m] V</span>
<span class="sd">                   3 o----------o 0</span>
<span class="sd">                     |          |</span>
<span class="sd">                     |          |</span>
<span class="sd">                     |          |</span>
<span class="sd">                   2 o----------o 1</span>
<span class="sd">    Args:</span>
<span class="sd">        nc: matrix with nodes coordinates</span>
<span class="sd">        r: matrix with R coordinates</span>
<span class="sd">        z: matrix with Z coordinates</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        matrix with row - the element number, cols: (1) - number of node no. 0, (2) - no. of node no. 1, (3) - node no. 2, (4) - node no. 3</span>
<span class="sd">    </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n2e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">n2e</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">n2e</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">nCols</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">nel_in_col</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">n2e</span><span class="p">)):</span>
        <span class="n">nel_in_col</span> <span class="o">=</span> <span class="n">nel_in_col</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">nel_in_col</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">nel_in_col</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">nCols</span> <span class="o">=</span> <span class="n">nCols</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">n2e</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">nCols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">nel_in_col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">n2e</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">nCols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">nel_in_col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">n2e</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">nCols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">nel_in_col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">n2e</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">nCols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">nel_in_col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">n2e</span></div>



<div class="viewcode-block" id="find_node">
<a class="viewcode-back" href="../major_lib.html#major_lib.find_node">[docs]</a>
<span class="k">def</span> <span class="nf">find_node</span><span class="p">(</span><span class="n">node_number</span><span class="p">,</span> <span class="n">n2e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Idefntyfication how a node(node_number) is numbered  belonging to elements and how it contact to other nodes</span>

<span class="sd">    Args:</span>
<span class="sd">        node_number: numbers of the nodes</span>
<span class="sd">        n2e: affiliation of nodes to elements</span>

<span class="sd">    Returns:</span>
<span class="sd">        information where nNode is the first (e0), second (e1), third (e2) and fourth (e3)</span>

<span class="sd">    Note:</span>
<span class="sd">        nodes numbering similar to nodes2elements(NC, R, Z) - see above</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n2e</span> <span class="o">==</span> <span class="n">node_number</span><span class="p">)</span>
    <span class="n">no_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">indices</span><span class="p">):</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">no_el</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">no_el</span></div>



<div class="viewcode-block" id="nodes_in_elements">
<a class="viewcode-back" href="../major_lib.html#major_lib.nodes_in_elements">[docs]</a>
<span class="k">def</span> <span class="nf">nodes_in_elements</span><span class="p">(</span><span class="n">n2e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Indentification of nodes in elements&quot;&quot;&quot;</span>
    <span class="n">n_in_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n2e</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n2e</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">find_node</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n2e</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">n_in_el</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">n_in_el</span></div>



<div class="viewcode-block" id="nodes_coordinates">
<a class="viewcode-back" href="../major_lib.html#major_lib.nodes_coordinates">[docs]</a>
<span class="k">def</span> <span class="nf">nodes_coordinates</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function which describes nodes coordinates</span>

<span class="sd">    Args:</span>
<span class="sd">        r: nodes R coordinate</span>
<span class="sd">        z: nodes Z coordinate</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">       nodes numbering and coordinates fixing, col. (1) - number of node, (2) - R coordinate [m], (3) - Z coordinate [m] </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nNod</span> <span class="o">=</span> <span class="n">rows</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">rows</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nNod</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rows</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rows</span><span class="p">(</span><span class="n">z</span><span class="p">)):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">nc</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
            <span class="n">nc</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">nc</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">nc</span></div>



<div class="viewcode-block" id="initial_temp">
<a class="viewcode-back" href="../major_lib.html#major_lib.initial_temp">[docs]</a>
<span class="k">def</span> <span class="nf">initial_temp</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">IN</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fixing temperature in the nodes at the begining vs depth</span>

<span class="sd">    Args:</span>
<span class="sd">        nc: nodes coordinates</span>
<span class="sd">        IN: geometry of well in input file</span>

<span class="sd">    Returns:</span>
<span class="sd">        matrix of temperature at the beginning in nodes</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">th0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">rows</span><span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rows</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">th0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">th0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">th0</span><span class="p">[</span><span class="n">rows</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">rows</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">th0</span><span class="p">[</span><span class="n">rows</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">rows</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">rows</span><span class="p">(</span><span class="n">nc</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">t</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp_1d</span><span class="p">(</span><span class="n">th0</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">t</span></div>



<div class="viewcode-block" id="a_mat_fix">
<a class="viewcode-back" href="../major_lib.html#major_lib.a_mat_fix">[docs]</a>
<span class="k">def</span> <span class="nf">a_mat_fix</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Temperature equalization factor [m²/s], based on input file</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name: excel input file</span>

<span class="sd">    Returns:</span>
<span class="sd">        matrix with columns 1-material number,2- temperature equalization factor [m²/s], 3- thermal conductivity coefficient [W/m*K]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">file_name</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;mat&quot;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="s2">&quot;A:D&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">a</span></div>



<div class="viewcode-block" id="working_scheme">
<a class="viewcode-back" href="../major_lib.html#major_lib.working_scheme">[docs]</a>
<span class="k">def</span> <span class="nf">working_scheme</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The procedure reads the working scheme of the well form Excel input file</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name: excel input file name</span>

<span class="sd">    Returns:</span>
<span class="sd">        matrix with cols 1 - time [s], 2 - flow [kg/s] (if positive production, negative reinjection), 3 - temperature [°C]; based on input file</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">file_name</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;work&quot;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="s2">&quot;A:D&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span>
    <span class="k">return</span> <span class="n">out</span></div>



<div class="viewcode-block" id="read_others">
<a class="viewcode-back" href="../major_lib.html#major_lib.read_others">[docs]</a>
<span class="k">def</span> <span class="nf">read_others</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The procedure reads the other important inputs form Excel input file</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name: excel input file name</span>

<span class="sd">    Returns:</span>
<span class="sd">        matrix col 1 - TDS of brine [kg_TDS/kg_pureH2O], 2 - the well casing roughnes [-], 3 - the iterative calculations accuracy [-]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">file_name</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;others&quot;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="s2">&quot;B:B&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span>
    <span class="k">return</span> <span class="n">out</span></div>



<div class="viewcode-block" id="check_mat">
<a class="viewcode-back" href="../major_lib.html#major_lib.check_mat">[docs]</a>
<span class="k">def</span> <span class="nf">check_mat</span><span class="p">(</span><span class="n">IN</span><span class="p">,</span> <span class="n">Grid</span><span class="p">,</span> <span class="n">n2e</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Selecting and linking material to elements, by coordinates R and Z</span>

<span class="sd">    Args:</span>
<span class="sd">        IN: well geometry with temperature distribution from imput excel file matrix</span>
<span class="sd">        Grid: grid nodes matrix</span>
<span class="sd">        n2e: nodes numbering with elements matrix</span>
<span class="sd">        nc: nodes coordinates matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">        matrix with elements assosiated with material</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nEl</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Grid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Grid</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nEl</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">nz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">IN</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">ne</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nEl</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">IN</span><span class="p">[</span><span class="n">nz</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">nc</span><span class="p">[</span><span class="n">n2e</span><span class="p">[</span><span class="n">ne</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">IN</span><span class="p">[</span><span class="n">nz</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">nc</span><span class="p">[</span><span class="n">n2e</span><span class="p">[</span><span class="n">ne</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="n">n2e</span><span class="p">[</span><span class="n">ne</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">IN</span><span class="p">[</span><span class="n">nz</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">nc</span><span class="p">[</span><span class="n">n2e</span><span class="p">[</span><span class="n">ne</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">IN</span><span class="p">[</span><span class="n">nz</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">mat</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">nz</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="n">n2e</span><span class="p">[</span><span class="n">ne</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">IN</span><span class="p">[</span><span class="n">nz</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">nc</span><span class="p">[</span><span class="n">n2e</span><span class="p">[</span><span class="n">ne</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">IN</span><span class="p">[</span><span class="n">nz</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">mat</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span> <span class="o">=</span> <span class="n">IN</span><span class="p">[</span><span class="n">nz</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">mat</span></div>



<div class="viewcode-block" id="first_type_boundary">
<a class="viewcode-back" href="../major_lib.html#major_lib.first_type_boundary">[docs]</a>
<span class="k">def</span> <span class="nf">first_type_boundary</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">n2e</span><span class="p">,</span> <span class="n">mat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Recognition and determination of the 1st type boundary condition</span>

<span class="sd">    Args:</span>
<span class="sd">        nc: matrix of R and Z coordinates</span>
<span class="sd">        n2e: nodes numbering with elements matrix</span>
<span class="sd">        mat: elements associated with materials matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of nodes with 1st boundary condition</span>

<span class="sd">    Note:</span>
<span class="sd">        If any node lays on a boundary, then in an element it belongs will contain -1.So if -1 is founded it informs us that the node is 1st type boundary condition</span>
<span class="sd">        If a node belongs to an element where Mat=0 (Mat=0 means fluid, eg. geohtermal water) then it is the 1st type boundary condition</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">FT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">FT2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">NB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc</span><span class="p">)):</span>
        <span class="n">NB</span> <span class="o">=</span> <span class="n">find_node</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n2e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NB</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">NB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">NB</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">NB</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">FT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FT</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">mat</span><span class="p">[</span><span class="n">find_node</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n2e</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="n">mat</span><span class="p">[</span><span class="n">find_node</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n2e</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="n">mat</span><span class="p">[</span><span class="n">find_node</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n2e</span><span class="p">)[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="n">mat</span><span class="p">[</span><span class="n">find_node</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n2e</span><span class="p">)[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">FT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FT</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">FT2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">FT</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">FT2</span></div>



<div class="viewcode-block" id="nodes_zones">
<a class="viewcode-back" href="../major_lib.html#major_lib.nodes_zones">[docs]</a>
<span class="k">def</span> <span class="nf">nodes_zones</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">n2e</span><span class="p">,</span> <span class="n">mat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The function links nodes in an element filled by fluid (eq. water), inside a well</span>

<span class="sd">    Args:</span>
<span class="sd">        Z: Z coordinates (depth)</span>
<span class="sd">        nc: matrix of R and Z coordinates</span>
<span class="sd">        n2e: nodes numbering with elements matrix</span>
<span class="sd">        mat: elements associated with materials matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of lists, where a row = a zone, and a list element = a node number in the zone</span>

<span class="sd">    Notes:</span>
<span class="sd">        Zones are numbered from Earth surface to the bottom of the well</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">NZ</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">mat</span><span class="p">[</span><span class="n">find_node</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n2e</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="n">mat</span><span class="p">[</span><span class="n">find_node</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n2e</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="n">mat</span><span class="p">[</span><span class="n">find_node</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n2e</span><span class="p">)[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="n">mat</span><span class="p">[</span><span class="n">find_node</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n2e</span><span class="p">)[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">WF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WF</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">WF</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">WF</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">nc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">WF</span><span class="p">:</span>
                <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="n">NZ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">nH2O</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">NZ</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">NZ</span><span class="p">[</span><span class="n">n</span><span class="p">])):</span>
                <span class="n">nH2O</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NZ</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
        <span class="n">nH2O</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">nH2O</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">nH2O</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">NZ</span></div>



<div class="viewcode-block" id="eq_temp_in_zone">
<a class="viewcode-back" href="../major_lib.html#major_lib.eq_temp_in_zone">[docs]</a>
<span class="k">def</span> <span class="nf">eq_temp_in_zone</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">NinZ</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Equalize temperatures in the zone. The important is temperature in the node with the highest number</span>

<span class="sd">    Args:</span>
<span class="sd">        t: matrix of temperatures in well</span>
<span class="sd">        NinZ: nodes in elements filled by fluid</span>

<span class="sd">    Returns:</span>
<span class="sd">        equalized temperature distribution matrix in zones</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">NinZ</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">NinZ</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">t</span><span class="p">[</span><span class="n">NinZ</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">NinZ</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">NinZ</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">t</span></div>



<div class="viewcode-block" id="temp_after_dtime">
<a class="viewcode-back" href="../major_lib.html#major_lib.temp_after_dtime">[docs]</a>
<span class="k">def</span> <span class="nf">temp_after_dtime</span><span class="p">(</span><span class="n">nw</span><span class="p">,</span> <span class="n">n2e</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">am</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dtime</span><span class="p">,</span> <span class="n">nodes_in_elements</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function calculating temperature after period of time</span>

<span class="sd">    Args:</span>
<span class="sd">        nw: node number                                 </span>
<span class="sd">        n2e: nodes numbering with elements matrix</span>
<span class="sd">        nc: matrix of R and Z coordinates</span>
<span class="sd">        mat: elements associated with materials matrix</span>
<span class="sd">        am: matrix with material numbers,temperature equalization factor and heat conduction coefficient from input excel file</span>
<span class="sd">        t: equalized temperature distribution matrix in zones</span>
<span class="sd">        dtime: suggested time step [s]</span>
<span class="sd">        nodes_in_elements: matrix with nodes in elements</span>

<span class="sd">    Returns:</span>
<span class="sd">        final temperature</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">NinE</span> <span class="o">=</span> <span class="n">nodes_in_elements</span><span class="p">[</span><span class="n">nw</span><span class="p">]</span>

    <span class="n">nw0</span> <span class="o">=</span> <span class="n">n2e</span><span class="p">[</span><span class="n">NinE</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">nw1</span> <span class="o">=</span> <span class="n">n2e</span><span class="p">[</span><span class="n">NinE</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">nw2</span> <span class="o">=</span> <span class="n">n2e</span><span class="p">[</span><span class="n">NinE</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">nw3</span> <span class="o">=</span> <span class="n">n2e</span><span class="p">[</span><span class="n">NinE</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">]</span>

    <span class="n">dx0</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">nw0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">nc</span><span class="p">[</span><span class="n">nw</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">dx1</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">nw1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nc</span><span class="p">[</span><span class="n">nw</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">dx2</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">nw</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">nc</span><span class="p">[</span><span class="n">nw2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">dx3</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">nw</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nc</span><span class="p">[</span><span class="n">nw3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">a_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">am</span><span class="p">[</span><span class="n">mat</span><span class="p">[</span><span class="n">NinE</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>

    <span class="n">dtspeed</span> <span class="o">=</span> <span class="n">fdm</span><span class="o">.</span><span class="n">dtdtime</span><span class="p">(</span>
        <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="n">nw0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">nw1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">nw2</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">nw3</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">nw</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">dx0</span><span class="p">,</span> <span class="n">dx1</span><span class="p">,</span> <span class="n">dx2</span><span class="p">,</span> <span class="n">dx3</span><span class="p">],</span>
        <span class="n">a_vals</span><span class="p">,</span>
        <span class="n">nc</span><span class="p">[</span><span class="n">nw</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">dt</span> <span class="o">=</span> <span class="n">dtspeed</span> <span class="o">*</span> <span class="n">dtime</span>
    <span class="n">tend</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">nw</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span>
    <span class="k">return</span> <span class="n">tend</span></div>



<div class="viewcode-block" id="well_param">
<a class="viewcode-back" href="../major_lib.html#major_lib.well_param">[docs]</a>
<span class="k">def</span> <span class="nf">well_param</span><span class="p">(</span><span class="n">wws</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function is sending back the working conditions of a well as one rows vector</span>

<span class="sd">    Args:</span>
<span class="sd">        wws: well working schedule from input excel file</span>
<span class="sd">        time: simulation time</span>

<span class="sd">    Returns:</span>
<span class="sd">        matrix col 1 - time [s], 2 - mass flow [kg/s], 3 - inlet temperature [°C]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">wws</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">time</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">wws</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">wws</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">A</span></div>



<div class="viewcode-block" id="temp_in_well">
<a class="viewcode-back" href="../major_lib.html#major_lib.temp_in_well">[docs]</a>
<span class="k">def</span> <span class="nf">temp_in_well</span><span class="p">(</span><span class="n">node_in_zone</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Temperature in nodes describing the well surface sourouned by rock matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        node_in_zone: nodes in elements filled by fluid</span>
<span class="sd">        t: equalized temperature distribution matrix in zones</span>
<span class="sd">        nc: matrix of R and Z coordinates</span>

<span class="sd">    Returns:</span>
<span class="sd">        temperature in nodes describing the well surface surrouned by rock matrix</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">node_in_zone</span><span class="p">),</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_in_zone</span><span class="p">)):</span>
        <span class="n">tz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_in_zone</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">node_in_zone</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">tz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">node_in_zone</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">node_in_zone</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">tz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">node_in_zone</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">node_in_zone</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">tz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">node_in_zone</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">node_in_zone</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">tz</span></div>


<div class="viewcode-block" id="max_dtime">
<a class="viewcode-back" href="../major_lib.html#major_lib.max_dtime">[docs]</a>
<span class="k">def</span> <span class="nf">max_dtime</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">n2e</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">am</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checking maximal allowed time step dtime [s], dependently on the grid shape and loaded coordinates</span>

<span class="sd">    Args:</span>
<span class="sd">        nc: matrix of R and Z coordinates</span>
<span class="sd">        n2e: nodes numbering with elements matrix</span>
<span class="sd">        mat: elements associated with materials matrix</span>
<span class="sd">        am: matrix with material numbers, temperature equalization factor and heat conduction coefficient from input excel file</span>
<span class="sd">        quality: convergence quality, can not be lower than 4, suggesed value 5</span>

<span class="sd">    Returns:</span>
<span class="sd">        maximal allowed time step [s]  </span>

<span class="sd">    Note:</span>
<span class="sd">        Solution of explicit method is stable for M&gt;=4. Wiśniewski &amp; Wiśniewski, Heat transfer, unit 3.4, page.147, equation 3.229</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">quality</span> <span class="o">&lt;=</span> <span class="mf">4.0</span><span class="p">:</span>
        <span class="n">quality</span> <span class="o">=</span> <span class="mf">4.0</span>

    <span class="n">dtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">mat</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mat</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">mat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dtime</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0e10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Dr</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">n2e</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">nc</span><span class="p">[</span><span class="n">n2e</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">am</span><span class="p">[</span><span class="n">mat</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">dtime</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dr</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">quality</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dtime</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>



<div class="viewcode-block" id="nodes_filled_with_brine">
<a class="viewcode-back" href="../major_lib.html#major_lib.nodes_filled_with_brine">[docs]</a>
<span class="k">def</span> <span class="nf">nodes_filled_with_brine</span><span class="p">(</span><span class="n">node_in_well</span><span class="p">,</span> <span class="n">n2e</span><span class="p">,</span> <span class="n">mat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Procedure indicates only nodes fully filled by brine in the order typical for matrix nide_in_well but node_in_well includes also nodes partly sourounded by brine and partly by the rocks matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        node_in_well: nodes in elements filled by fluid</span>
<span class="sd">        n2e: nodes numbering with elements matrix</span>
<span class="sd">        mat: elements associated with materials matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">        matrix of nodes fully filled with brine</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">NFB</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_in_well</span><span class="p">)):</span>
        <span class="n">hlp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_in_well</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="n">nodeNumber</span> <span class="o">=</span> <span class="n">node_in_well</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">noEls</span> <span class="o">=</span> <span class="n">find_node</span><span class="p">(</span><span class="n">nodeNumber</span><span class="p">,</span> <span class="n">n2e</span><span class="p">)</span>
            <span class="n">onlyBrine</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">noEls</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">onlyBrine</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">mat</span><span class="p">[</span><span class="n">noEls</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">onlyBrine</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">onlyBrine</span><span class="p">:</span>
                <span class="n">hlp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_in_well</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="n">NFB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hlp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">NFB</span></div>



<div class="viewcode-block" id="disribute_temp_changes">
<a class="viewcode-back" href="../major_lib.html#major_lib.disribute_temp_changes">[docs]</a>
<span class="k">def</span> <span class="nf">disribute_temp_changes</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">twellNew</span><span class="p">,</span> <span class="n">twell0</span><span class="p">,</span> <span class="n">node_in_zone</span><span class="p">,</span> <span class="n">node_with_brine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function determines how the temperature changes in nodes filled with brine and nodes on the exchanger wall</span>

<span class="sd">    Args:</span>
<span class="sd">        t0: distribution of temperature in nodes</span>
<span class="sd">        twellNew: distribution of temperature in well after time</span>
<span class="sd">        twell0: distribution of temperature in well at the beginning</span>
<span class="sd">        nodes_in_zone: nodes in elements filled by fluid</span>
<span class="sd">        node_with_brine: nodes filed by brine</span>

<span class="sd">    Returns:</span>
<span class="sd">        new distibution of temperature</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">t0</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t0</span><span class="p">)):</span>
        <span class="n">tnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">twell0</span><span class="p">)):</span>
        <span class="n">NodeNumber</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">twell0</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">tnew</span><span class="p">[</span><span class="n">NodeNumber</span><span class="p">]</span> <span class="o">=</span> <span class="n">twellNew</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">tnew</span> <span class="o">=</span> <span class="n">eq_temp_in_zone</span><span class="p">(</span><span class="n">tnew</span><span class="p">,</span> <span class="n">node_in_zone</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">twellNew</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_with_brine</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="n">NodeNumber</span> <span class="o">=</span> <span class="n">node_with_brine</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">tnew</span><span class="p">[</span><span class="n">NodeNumber</span><span class="p">]</span> <span class="o">=</span> <span class="n">twellNew</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">tnew</span></div>



<div class="viewcode-block" id="prod_calculations">
<a class="viewcode-back" href="../major_lib.html#major_lib.prod_calculations">[docs]</a>
<span class="k">def</span> <span class="nf">prod_calculations</span><span class="p">(</span>
    <span class="n">wws</span><span class="p">,</span>
    <span class="n">dtime</span><span class="p">,</span>
    <span class="n">dtime_max</span><span class="p">,</span>
    <span class="n">t0</span><span class="p">,</span>
    <span class="n">twell0</span><span class="p">,</span>
    <span class="n">n2e</span><span class="p">,</span>
    <span class="n">nc</span><span class="p">,</span>
    <span class="n">Z</span><span class="p">,</span>
    <span class="n">R</span><span class="p">,</span>
    <span class="n">mat</span><span class="p">,</span>
    <span class="n">am</span><span class="p">,</span>
    <span class="n">NinWell</span><span class="p">,</span>
    <span class="n">NfbB</span><span class="p">,</span>
    <span class="n">actvN</span><span class="p">,</span>
    <span class="n">others</span><span class="p">,</span>
    <span class="n">nodes_top</span><span class="p">,</span>
    <span class="n">nodes_in_elements</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main function for calculation of production well</span>

<span class="sd">    Args:</span>
<span class="sd">        wws: well working schedule from input excel file</span>
<span class="sd">        dtime: maximal allowed time step</span>
<span class="sd">        dtime_max: maximal allowed time step</span>
<span class="sd">        t0: initial temperature in modell</span>
<span class="sd">        twell0: temperature distribution in nodes in well</span>
<span class="sd">        n2e: nodes numbering with elements matrix</span>
<span class="sd">        nc: nodes coordinates matrix</span>
<span class="sd">        Z: nodes coordinate Z</span>
<span class="sd">        R: nodes coordinate R</span>
<span class="sd">        mat: elements associated with materials matrix</span>
<span class="sd">        am: matrix with material numbers, temperature equalization factor and heat conduction coefficient from input excel file</span>
<span class="sd">        NinWell: nodes in elements filled by fluid</span>
<span class="sd">        NfbB: nodes filled by brine</span>
<span class="sd">        actvN: active nodes </span>
<span class="sd">        others: parameters from &quot;others sheet&quot; in excel input file</span>
<span class="sd">        nodes_top: nodes on the top of the well</span>
<span class="sd">        node_in_elements: matrix with nodes in elements</span>

<span class="sd">    Returns:</span>
<span class="sd">        matrix of temperatures distribution in model after time step</span>

<span class="sd">    Note: Here are graphs defined which are displayed at the end of simulation.\n</span>
<span class="sd">        *Wellhead temperature vs time\n</span>
<span class="sd">        *Temperature vs depth at the end\n</span>
<span class="sd">        *Temperature or rock at depth of &#39;+str(round(NC[nR,2],2))+&#39; m at the end\n</span>
<span class="sd">        *Temperature distribution vs R and Z</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tHeadTime</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">show_graphic_results</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">PipeRoughness</span> <span class="o">=</span> <span class="n">others</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">others</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">others</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">DtimeDynamic</span> <span class="o">=</span> <span class="n">dtime</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">twell_1</span> <span class="o">=</span> <span class="n">twell0</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">list_excel</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="n">DtimeDynamic</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">wws</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">wws</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="n">dtime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="n">DtimeDynamic</span> <span class="o">=</span> <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DtimeDynamic</span> <span class="o">=</span> <span class="n">dtime</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="n">DtimeDynamic</span>

        <span class="n">tHeadTime</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="n">twell_1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>

        <span class="n">twellNe</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">prod_well</span><span class="p">(</span>
            <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="n">S</span><span class="p">,</span>
            <span class="n">twell0</span><span class="p">,</span>
            <span class="n">t0</span><span class="p">,</span>
            <span class="n">DtimeDynamic</span><span class="p">,</span>
            <span class="n">PipeRoughness</span><span class="p">,</span>
            <span class="n">accuracy</span><span class="p">,</span>
            <span class="n">n2e</span><span class="p">,</span>
            <span class="n">nc</span><span class="p">,</span>
            <span class="n">Z</span><span class="p">,</span>
            <span class="n">mat</span><span class="p">,</span>
            <span class="n">am</span><span class="p">,</span>
            <span class="n">nodes_in_elements</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">twellNew</span> <span class="o">=</span> <span class="n">twellNe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">PR</span> <span class="o">=</span> <span class="n">twellNe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">PR</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        <span class="n">list_excel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PR</span><span class="p">)</span>

        <span class="n">twellNew</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">twellNew</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">tnew</span> <span class="o">=</span> <span class="n">disribute_temp_changes</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">twellNew</span><span class="p">,</span> <span class="n">twell0</span><span class="p">,</span> <span class="n">NinWell</span><span class="p">,</span> <span class="n">NfbB</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">nw</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">actvN</span><span class="p">)):</span>
            <span class="n">tnew</span><span class="p">[</span><span class="n">actvN</span><span class="p">[</span><span class="n">nw</span><span class="p">]]</span> <span class="o">=</span> <span class="n">temp_after_dtime</span><span class="p">(</span>
                <span class="n">actvN</span><span class="p">[</span><span class="n">nw</span><span class="p">],</span>
                <span class="n">n2e</span><span class="p">,</span>
                <span class="n">nc</span><span class="p">,</span>
                <span class="n">mat</span><span class="p">,</span>
                <span class="n">am</span><span class="p">,</span>
                <span class="n">tnew</span><span class="p">,</span>
                <span class="n">DtimeDynamic</span><span class="p">,</span>
                <span class="n">nodes_in_elements</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">tnew</span>

        <span class="k">for</span> <span class="n">nw</span> <span class="ow">in</span> <span class="n">nodes_top</span><span class="p">:</span>
            <span class="n">t0</span><span class="p">[</span><span class="n">nw</span><span class="p">]</span> <span class="o">=</span> <span class="n">t0</span><span class="p">[</span><span class="n">nw</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">tnew</span><span class="p">[</span><span class="n">nw</span><span class="p">]</span> <span class="o">=</span> <span class="n">tnew</span><span class="p">[</span><span class="n">nw</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">twell_1</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">twell_convert_twell0</span><span class="p">(</span><span class="n">twell0</span><span class="p">,</span> <span class="n">twellNew</span><span class="p">)</span>

        <span class="n">twell0</span> <span class="o">=</span> <span class="n">twell_1</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="n">DtimeDynamic</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">wws</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">wws</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;- 100.00</span><span class="si">% o</span><span class="s2">f expected time (&quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;hr) | time step length: &quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">DtimeDynamic</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot; sec | bottom / wellhead temp. &quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">twell_1</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">twell_1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">twell_1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;°C&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;- &quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">time</span> <span class="o">/</span> <span class="n">wws</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">wws</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;</span><span class="si">% o</span><span class="s2">f time (&quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;hr) | time step length: &quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">DtimeDynamic</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot; sec | bottom / wellhead temp. &quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">twell_1</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">twell_1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">twell_1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;°C&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">&gt;=</span> <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">dtime</span> <span class="o">=</span> <span class="n">dtime</span> <span class="o">+</span> <span class="mf">10.0</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">dtime</span> <span class="o">&gt;</span> <span class="n">dtime_max</span><span class="p">:</span>
            <span class="n">dtime</span> <span class="o">=</span> <span class="n">dtime_max</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">list_excel</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;temperature&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pressure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;velocity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pDynamic&quot;</span><span class="p">,</span>
                <span class="s2">&quot;density&quot;</span><span class="p">,</span>
                <span class="s2">&quot;spec heat&quot;</span><span class="p">,</span>
                <span class="s2">&quot;press_drop&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mass flow&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alfaB&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">&quot;wellhead_out_last_time.xlsx&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_graphic_results</span><span class="p">:</span>
        <span class="n">tHead_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tHeadTime</span><span class="p">)</span>
        <span class="n">fig1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tHead_time</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">tHead_time</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Wellhead temperature [°C]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Wellhead temperature vs time&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_graphic_results</span><span class="p">:</span>
        <span class="n">tvsH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">nw</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">tvsH</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">nw</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="n">tvsH</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">twell0</span><span class="p">[</span><span class="n">nw</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">fig2</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tvsH</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">tvsH</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature [°C]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Depth [m]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Temperature vs depth at the end time&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_graphic_results</span><span class="p">:</span>
        <span class="n">nR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nR</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nR</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">tvsR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">nw</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">nwr</span> <span class="o">=</span> <span class="n">nR</span> <span class="o">+</span> <span class="n">nw</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
            <span class="n">tvsR</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">nwr</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">tvsR</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tnew</span><span class="p">[</span><span class="n">nwr</span><span class="p">]</span>
        <span class="n">fig3</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tvsR</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">tvsR</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius [m]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature [°C]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="s2">&quot;Temperature of rock at depth of &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="n">nR</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
            <span class="o">+</span> <span class="s2">&quot; m at the end&quot;</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_graphic_results</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)])</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)])</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">x</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">y</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span>
                <span class="n">z</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">tnew</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">fig4</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">contour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius [m]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Depth [m]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Temperature distribution vs R and H [°C]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig4</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Temperature [°C]&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tnew</span></div>



<div class="viewcode-block" id="inj_well_guess_press_head">
<a class="viewcode-back" href="../major_lib.html#major_lib.inj_well_guess_press_head">[docs]</a>
<span class="k">def</span> <span class="nf">inj_well_guess_press_head</span><span class="p">(</span>
    <span class="n">m</span><span class="p">,</span>
    <span class="n">t</span><span class="p">,</span>
    <span class="n">pBottom</span><span class="p">,</span>
    <span class="n">S</span><span class="p">,</span>
    <span class="n">tr</span><span class="p">,</span>
    <span class="n">tRockMatrix</span><span class="p">,</span>
    <span class="n">dtime</span><span class="p">,</span>
    <span class="n">fi</span><span class="p">,</span>
    <span class="n">acc</span><span class="p">,</span>
    <span class="n">n2e</span><span class="p">,</span>
    <span class="n">nc</span><span class="p">,</span>
    <span class="n">Z</span><span class="p">,</span>
    <span class="n">mat</span><span class="p">,</span>
    <span class="n">am</span><span class="p">,</span>
    <span class="n">nodes_top</span><span class="p">,</span>
    <span class="n">nodes_in_elements</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function which assess pressure at the wellhead</span>

<span class="sd">    Args:</span>
<span class="sd">        m: mass flow rate</span>
<span class="sd">        t: temperature of injected fluid</span>
<span class="sd">        pBottom: pressure at the bottom of well</span>
<span class="sd">        S: mineralisation</span>
<span class="sd">        tr: matrix of rock temperature in nodes belonged to a well</span>
<span class="sd">        tRockMatrix: matrix of temperatures in rock</span>
<span class="sd">        dtime: maximal allowed time step</span>
<span class="sd">        fi: pipe wall roughness coefficient</span>
<span class="sd">        acc: iterative accuracy from input excel file</span>
<span class="sd">        n2e: nodes numbering with elements matrix</span>
<span class="sd">        nc: nodes coordinates matrix</span>
<span class="sd">        z: nodes coordinate Z</span>
<span class="sd">        mat: elements associated with materials matrix</span>
<span class="sd">        am: matrix with material numbers, temperature equalization factor and heat conduction coefficient from input excel file</span>
<span class="sd">        nodes_top: nodes on the top of the well</span>
<span class="sd">        node_in_elements: matrix with nodes in elements</span>

<span class="sd">    Returns:</span>
<span class="sd">        pressure at wellhead [Pa]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pHeadMin</span> <span class="o">=</span> <span class="mf">101325.0</span>
    <span class="n">pHeadMax</span> <span class="o">=</span> <span class="n">pBottom</span>
    <span class="n">pHeadAver</span> <span class="o">=</span> <span class="p">(</span><span class="n">pHeadMin</span> <span class="o">+</span> <span class="n">pHeadMax</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>

    <span class="n">pBottomMin</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">inj_well</span><span class="p">(</span>
        <span class="n">m</span><span class="p">,</span>
        <span class="n">t</span><span class="p">,</span>
        <span class="n">pHeadMin</span><span class="p">,</span>
        <span class="n">S</span><span class="p">,</span>
        <span class="n">tr</span><span class="p">,</span>
        <span class="n">tRockMatrix</span><span class="p">,</span>
        <span class="n">dtime</span><span class="p">,</span>
        <span class="n">fi</span><span class="p">,</span>
        <span class="n">acc</span><span class="p">,</span>
        <span class="n">n2e</span><span class="p">,</span>
        <span class="n">nc</span><span class="p">,</span>
        <span class="n">Z</span><span class="p">,</span>
        <span class="n">mat</span><span class="p">,</span>
        <span class="n">am</span><span class="p">,</span>
        <span class="n">nodes_top</span><span class="p">,</span>
        <span class="n">nodes_in_elements</span><span class="p">,</span>
    <span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">pBottomMax</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">inj_well</span><span class="p">(</span>
        <span class="n">m</span><span class="p">,</span>
        <span class="n">t</span><span class="p">,</span>
        <span class="n">pHeadMax</span><span class="p">,</span>
        <span class="n">S</span><span class="p">,</span>
        <span class="n">tr</span><span class="p">,</span>
        <span class="n">tRockMatrix</span><span class="p">,</span>
        <span class="n">dtime</span><span class="p">,</span>
        <span class="n">fi</span><span class="p">,</span>
        <span class="n">acc</span><span class="p">,</span>
        <span class="n">n2e</span><span class="p">,</span>
        <span class="n">nc</span><span class="p">,</span>
        <span class="n">Z</span><span class="p">,</span>
        <span class="n">mat</span><span class="p">,</span>
        <span class="n">am</span><span class="p">,</span>
        <span class="n">nodes_top</span><span class="p">,</span>
        <span class="n">nodes_in_elements</span><span class="p">,</span>
    <span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">pBottomAver</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">inj_well</span><span class="p">(</span>
        <span class="n">m</span><span class="p">,</span>
        <span class="n">t</span><span class="p">,</span>
        <span class="n">pHeadAver</span><span class="p">,</span>
        <span class="n">S</span><span class="p">,</span>
        <span class="n">tr</span><span class="p">,</span>
        <span class="n">tRockMatrix</span><span class="p">,</span>
        <span class="n">dtime</span><span class="p">,</span>
        <span class="n">fi</span><span class="p">,</span>
        <span class="n">acc</span><span class="p">,</span>
        <span class="n">n2e</span><span class="p">,</span>
        <span class="n">nc</span><span class="p">,</span>
        <span class="n">Z</span><span class="p">,</span>
        <span class="n">mat</span><span class="p">,</span>
        <span class="n">am</span><span class="p">,</span>
        <span class="n">nodes_top</span><span class="p">,</span>
        <span class="n">nodes_in_elements</span><span class="p">,</span>
    <span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pBottomMax</span> <span class="o">-</span> <span class="n">pBottomMin</span><span class="p">)</span> <span class="o">/</span> <span class="n">pBottomAver</span> <span class="o">&gt;</span> <span class="n">acc</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pBottomAver</span> <span class="o">&gt;=</span> <span class="n">pBottom</span><span class="p">:</span>
            <span class="n">pHeadMax</span> <span class="o">=</span> <span class="n">pHeadAver</span>
        <span class="k">if</span> <span class="n">pBottomAver</span> <span class="o">&lt;</span> <span class="n">pBottom</span><span class="p">:</span>
            <span class="n">pHeadMin</span> <span class="o">=</span> <span class="n">pHeadAver</span>
        <span class="n">pHeadAver</span> <span class="o">=</span> <span class="p">(</span><span class="n">pHeadMin</span> <span class="o">+</span> <span class="n">pHeadMax</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">pBottomMin</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">inj_well</span><span class="p">(</span>
            <span class="n">m</span><span class="p">,</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">pHeadMin</span><span class="p">,</span>
            <span class="n">S</span><span class="p">,</span>
            <span class="n">tr</span><span class="p">,</span>
            <span class="n">tRockMatrix</span><span class="p">,</span>
            <span class="n">dtime</span><span class="p">,</span>
            <span class="n">fi</span><span class="p">,</span>
            <span class="n">acc</span><span class="p">,</span>
            <span class="n">n2e</span><span class="p">,</span>
            <span class="n">nc</span><span class="p">,</span>
            <span class="n">Z</span><span class="p">,</span>
            <span class="n">mat</span><span class="p">,</span>
            <span class="n">am</span><span class="p">,</span>
            <span class="n">nodes_top</span><span class="p">,</span>
            <span class="n">nodes_in_elements</span><span class="p">,</span>
        <span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
        <span class="n">pBottomMax</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">inj_well</span><span class="p">(</span>
            <span class="n">m</span><span class="p">,</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">pHeadMax</span><span class="p">,</span>
            <span class="n">S</span><span class="p">,</span>
            <span class="n">tr</span><span class="p">,</span>
            <span class="n">tRockMatrix</span><span class="p">,</span>
            <span class="n">dtime</span><span class="p">,</span>
            <span class="n">fi</span><span class="p">,</span>
            <span class="n">acc</span><span class="p">,</span>
            <span class="n">n2e</span><span class="p">,</span>
            <span class="n">nc</span><span class="p">,</span>
            <span class="n">Z</span><span class="p">,</span>
            <span class="n">mat</span><span class="p">,</span>
            <span class="n">am</span><span class="p">,</span>
            <span class="n">nodes_top</span><span class="p">,</span>
            <span class="n">nodes_in_elements</span><span class="p">,</span>
        <span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
        <span class="n">pBottomAver</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">inj_well</span><span class="p">(</span>
            <span class="n">m</span><span class="p">,</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">pHeadAver</span><span class="p">,</span>
            <span class="n">S</span><span class="p">,</span>
            <span class="n">tr</span><span class="p">,</span>
            <span class="n">tRockMatrix</span><span class="p">,</span>
            <span class="n">dtime</span><span class="p">,</span>
            <span class="n">fi</span><span class="p">,</span>
            <span class="n">acc</span><span class="p">,</span>
            <span class="n">n2e</span><span class="p">,</span>
            <span class="n">nc</span><span class="p">,</span>
            <span class="n">Z</span><span class="p">,</span>
            <span class="n">mat</span><span class="p">,</span>
            <span class="n">am</span><span class="p">,</span>
            <span class="n">nodes_top</span><span class="p">,</span>
            <span class="n">nodes_in_elements</span><span class="p">,</span>
        <span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">pHead</span> <span class="o">=</span> <span class="n">pHeadAver</span>
    <span class="k">return</span> <span class="n">pHead</span></div>



<div class="viewcode-block" id="inj_calculations">
<a class="viewcode-back" href="../major_lib.html#major_lib.inj_calculations">[docs]</a>
<span class="k">def</span> <span class="nf">inj_calculations</span><span class="p">(</span>
    <span class="n">wws</span><span class="p">,</span>
    <span class="n">dtime</span><span class="p">,</span>
    <span class="n">dtime_max</span><span class="p">,</span>
    <span class="n">t0</span><span class="p">,</span>
    <span class="n">twell0</span><span class="p">,</span>
    <span class="n">n2e</span><span class="p">,</span>
    <span class="n">nc</span><span class="p">,</span>
    <span class="n">Z</span><span class="p">,</span>
    <span class="n">R</span><span class="p">,</span>
    <span class="n">mat</span><span class="p">,</span>
    <span class="n">am</span><span class="p">,</span>
    <span class="n">NinWell</span><span class="p">,</span>
    <span class="n">NfbB</span><span class="p">,</span>
    <span class="n">actvN</span><span class="p">,</span>
    <span class="n">others</span><span class="p">,</span>
    <span class="n">nodes_top</span><span class="p">,</span>
    <span class="n">nodes_bottom</span><span class="p">,</span>
    <span class="n">nodes_in_elements</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main function for calculation of injection well</span>

<span class="sd">    Args:</span>
<span class="sd">        wws: well working schedule from input excel file</span>
<span class="sd">        dtime: maximal allowed time step</span>
<span class="sd">        dtime_max: maximal allowed time step</span>
<span class="sd">        t0: initial temperature in modell</span>
<span class="sd">        twell0: temperature distribution in nodes in well</span>
<span class="sd">        n2e: nodes numbering with elements matrix</span>
<span class="sd">        nc: nodes coordinates matrix</span>
<span class="sd">        Z: nodes coordinate Z</span>
<span class="sd">        R: nodes coordinate R</span>
<span class="sd">        mat: elements associated with materials matrix</span>
<span class="sd">        am: matrix with material numbers, temperature equalization factor and heat conduction coefficient from input excel file</span>
<span class="sd">        NinWell: nodes in elements filled by fluid</span>
<span class="sd">        NfbB: nodes filled by brine</span>
<span class="sd">        actvN: active nodes </span>
<span class="sd">        others: parameters from &quot;others sheet&quot; in excel input file</span>
<span class="sd">        nodes_top: nodes on the top of the well</span>
<span class="sd">        node_in_elements: matrix with nodes in elements</span>

<span class="sd">    Returns:</span>
<span class="sd">        matrix of temperatures distribution in model</span>

<span class="sd">    Note: Here are graphs defined which are displayed at the end of simulation.\n</span>
<span class="sd">        *Wellhead temperature vs time\n</span>
<span class="sd">        *Temperature vs depth at the end\n</span>
<span class="sd">        *Temperature or rock at depth of &#39;+str(round(NC[nR,2],2))+&#39; m at the end\n</span>
<span class="sd">        *Temperature distribution vs R and Z*</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tHeadTime</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pHeadTime</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">show_graphic_results</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wws</span><span class="p">)):</span>
        <span class="n">wws</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">wws</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="n">PipeRoughness</span> <span class="o">=</span> <span class="n">others</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">others</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">others</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">DtimeDynamic</span> <span class="o">=</span> <span class="n">dtime</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">twell_1</span> <span class="o">=</span> <span class="n">twell0</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="n">DtimeDynamic</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">wws</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">wws</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="n">dtime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="n">DtimeDynamic</span> <span class="o">=</span> <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DtimeDynamic</span> <span class="o">=</span> <span class="n">dtime</span>

        <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="n">DtimeDynamic</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="n">DtimeDynamic</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">wws</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">wws</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;- 100.00</span><span class="si">% o</span><span class="s2">f expected time (&quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;hr) | time step length: &quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">DtimeDynamic</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot; sec | wellhead / bottom temp. &quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">twell_1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">twell_1</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">twell_1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;°C&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;- &quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">time</span> <span class="o">/</span> <span class="n">wws</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">wws</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;</span><span class="si">% o</span><span class="s2">f time (&quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;hr) | time step length: &quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">DtimeDynamic</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot; sec | wellhead / bottom temp. &quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">twell_1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">twell_1</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">twell_1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;°C&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">tHeadTime</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="n">twell_1</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>

        <span class="n">pHead</span> <span class="o">=</span> <span class="n">inj_well_guess_press_head</span><span class="p">(</span>
            <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="n">S</span><span class="p">,</span>
            <span class="n">twell0</span><span class="p">,</span>
            <span class="n">t0</span><span class="p">,</span>
            <span class="n">DtimeDynamic</span><span class="p">,</span>
            <span class="n">PipeRoughness</span><span class="p">,</span>
            <span class="n">accuracy</span><span class="p">,</span>
            <span class="n">n2e</span><span class="p">,</span>
            <span class="n">nc</span><span class="p">,</span>
            <span class="n">Z</span><span class="p">,</span>
            <span class="n">mat</span><span class="p">,</span>
            <span class="n">am</span><span class="p">,</span>
            <span class="n">nodes_top</span><span class="p">,</span>
            <span class="n">nodes_in_elements</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pHeadTime</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="n">pHead</span><span class="p">])</span>
        <span class="n">twellNew</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">inj_well</span><span class="p">(</span>
            <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="n">pHead</span><span class="p">,</span>
            <span class="n">S</span><span class="p">,</span>
            <span class="n">twell0</span><span class="p">,</span>
            <span class="n">t0</span><span class="p">,</span>
            <span class="n">DtimeDynamic</span><span class="p">,</span>
            <span class="n">PipeRoughness</span><span class="p">,</span>
            <span class="n">accuracy</span><span class="p">,</span>
            <span class="n">n2e</span><span class="p">,</span>
            <span class="n">nc</span><span class="p">,</span>
            <span class="n">Z</span><span class="p">,</span>
            <span class="n">mat</span><span class="p">,</span>
            <span class="n">am</span><span class="p">,</span>
            <span class="n">nodes_top</span><span class="p">,</span>
            <span class="n">nodes_in_elements</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">tnew</span> <span class="o">=</span> <span class="n">disribute_temp_changes</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">twellNew</span><span class="p">,</span> <span class="n">twell0</span><span class="p">,</span> <span class="n">NinWell</span><span class="p">,</span> <span class="n">NfbB</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">nw</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">actvN</span><span class="p">)):</span>
            <span class="n">tnew</span><span class="p">[</span><span class="n">actvN</span><span class="p">[</span><span class="n">nw</span><span class="p">]]</span> <span class="o">=</span> <span class="n">temp_after_dtime</span><span class="p">(</span>
                <span class="n">actvN</span><span class="p">[</span><span class="n">nw</span><span class="p">],</span>
                <span class="n">n2e</span><span class="p">,</span>
                <span class="n">nc</span><span class="p">,</span>
                <span class="n">mat</span><span class="p">,</span>
                <span class="n">am</span><span class="p">,</span>
                <span class="n">tnew</span><span class="p">,</span>
                <span class="n">DtimeDynamic</span><span class="p">,</span>
                <span class="n">nodes_in_elements</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">tnew</span>

        <span class="k">for</span> <span class="n">nw</span> <span class="ow">in</span> <span class="n">nodes_top</span><span class="p">:</span>
            <span class="n">t0</span><span class="p">[</span><span class="n">nw</span><span class="p">]</span> <span class="o">=</span> <span class="n">t0</span><span class="p">[</span><span class="n">nw</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">tnew</span><span class="p">[</span><span class="n">nw</span><span class="p">]</span> <span class="o">=</span> <span class="n">tnew</span><span class="p">[</span><span class="n">nw</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">nw</span> <span class="ow">in</span> <span class="n">nodes_bottom</span><span class="p">:</span>
            <span class="n">t0</span><span class="p">[</span><span class="n">nw</span><span class="p">]</span> <span class="o">=</span> <span class="n">t0</span><span class="p">[</span><span class="n">nw</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">tnew</span><span class="p">[</span><span class="n">nw</span><span class="p">]</span> <span class="o">=</span> <span class="n">tnew</span><span class="p">[</span><span class="n">nw</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">twell_1</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">twell_convert_twell0</span><span class="p">(</span><span class="n">twell0</span><span class="p">,</span> <span class="n">twellNew</span><span class="p">)</span>
        <span class="n">twell0</span> <span class="o">=</span> <span class="n">twell_1</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">&gt;=</span> <span class="n">wws</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">dtime</span> <span class="o">=</span> <span class="n">dtime</span> <span class="o">+</span> <span class="mf">5.0</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">dtime</span> <span class="o">&gt;</span> <span class="n">dtime_max</span><span class="p">:</span>
            <span class="n">dtime</span> <span class="o">=</span> <span class="n">dtime_max</span>

    <span class="k">if</span> <span class="n">show_graphic_results</span><span class="p">:</span>
        <span class="n">tHead_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tHeadTime</span><span class="p">)</span>
        <span class="n">fig1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tHead_time</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">tHead_time</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature at the liner depth [°C]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Temperature at the liner depth vs time&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_graphic_results</span><span class="p">:</span>
        <span class="n">pHead_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pHeadTime</span><span class="p">)</span>
        <span class="n">fig2</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">pHead_time</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">pHead_time</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1.0e6</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pressure on the wellhead [MPa]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Pressure on the wellhead vs time&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_graphic_results</span><span class="p">:</span>
        <span class="n">tvsH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">nw</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">tvsH</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">nw</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="n">tvsH</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tnew</span><span class="p">[</span><span class="n">nw</span><span class="p">]</span>
        <span class="n">fig4</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tvsH</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">tvsH</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature [°C]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Depth [m]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Temperature vs depth at the end&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_graphic_results</span><span class="p">:</span>
        <span class="n">nR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nR</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nR</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">tvsR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">nw</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">nwr</span> <span class="o">=</span> <span class="n">nR</span> <span class="o">+</span> <span class="n">nw</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
            <span class="n">tvsR</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">nwr</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">tvsR</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tnew</span><span class="p">[</span><span class="n">nwr</span><span class="p">]</span>
        <span class="n">fig4</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tvsR</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">tvsR</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius [m]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature [°C]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="s2">&quot;Temperature or rock at depth of &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="n">nR</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
            <span class="o">+</span> <span class="s2">&quot; m at the end&quot;</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_graphic_results</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)])</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)])</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">x</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">y</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span>
                <span class="n">z</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">tnew</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">fig5</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">contour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius [m]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Depth [m]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Temperature distribution vs R and h [°C]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig5</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Temperature [°C]&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tnew</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Karol Pierzchala (MEERI PAS).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>